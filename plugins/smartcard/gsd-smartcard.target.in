[Unit]
Description=GNOME Smartcard handling

Requisite=gnome-session-initialized.target
After=gnome-session-initialized.target
PartOf=gnome-session-initialized.target
Before=gnome-session.target

# Start when smartcard hardware is present (requires systemd v234)
# https://github.com/systemd/systemd/issues/12330
#Requisite=smartcard.target
#After=smartcard.target
#PartOf=smartcard.target

[Service]
Type=dbus
ExecStart=@libexecdir@/gsd-smartcard
Restart=on-failure
BusName=@plugin_dbus_name@

# We cannot use OnFailure as that may be called for dependency issues
ExecStopPost=@libexecdir@/gnome-session-ctl --fail-if-start-limit-hit

[Install]
WantedBy=gnome-session-initialized.target
#WantedBy=smartcard.target
